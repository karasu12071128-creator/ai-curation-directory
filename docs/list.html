---
layout: default
title: Resources
---
<h2>Resources</h2>

<div style="margin:12px 0;">
  <input id="q" placeholder="キーワード / tag を入力（例: diffusion, llm）" />
  <select id="sort" style="margin-left:8px;">
    <option value="latest">更新が新しい順</option>
    <option value="score">scoreが高い順</option>
    <option value="title">タイトル順</option>
  </select>
  <select id="type" style="margin-left:8px;">
    <option value="">すべての種類</option>
    <option value="hf_model">hf_model</option>
    <option value="hf_dataset">hf_dataset</option>
    <option value="hf_space">hf_space</option>
    <option value="github_repo">github_repo</option>
  </select>
  <select id="license" style="margin-left:8px;">
    <option value="">すべてのライセンス</option>
    <!-- 動的に license:xxx を埋めます -->
  </select>
</div>

<div id="quickTags" style="margin:6px 0 12px;"></div>

<div style="opacity:.8;font-size:.9em;">
  <span id="count">0</span> items
  <span id="pageInfo" style="float:right;"></span>
</div>

<div id="list" style="margin-top:8px;"></div>

<div style="margin:12px 0;display:flex;gap:8px;justify-content:center;">
  <button id="prev">Prev</button>
  <button id="next">Next</button>
</div>

<script>
(async () => {
  const res = await fetch('{{ '/resources.json' | relative_url }}');
  const data = await res.json();

  const q = document.getElementById('q');
  const sortSel = document.getElementById('sort');
  const typeSel = document.getElementById('type');
  const licenseSel = document.getElementById('license');
  const quick = document.getElementById('quickTags');
  const list = document.getElementById('list');
  const count = document.getElementById('count');
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const pageInfo = document.getElementById('pageInfo');

  const PAGE = 48;
  let page = 1;
  let activeTags = new Set();

  const esc = s => (s||'').toString().replace(/[&<>\"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  const toDate = s => s ? (s+'').slice(0,10) : '';

  // license 抽出（tag の "license:xxx" から）
  const licenses = Array.from(new Set(
    data.flatMap(x => (x.tags||[])
      .filter(t => /^license:/.test(t))
      .map(t => t.replace(/^license:/,'')))
  )).sort();
  licenseSel.innerHTML = '<option value="">すべてのライセンス</option>' +
    licenses.map(l => `<option value="${esc(l)}">${esc(l)}</option>`).join('');

  function topNTags(n=20){
    const ignore = /^(license:|dataset:)/;
    const freq = new Map();
    for(const x of data){
      for(const t of (x.tags||[])){
        if(ignore.test(t)) continue;
        const key = (t||'').trim();
        if(!key) continue;
        freq.set(key, (freq.get(key)||0)+1);
      }
    }
    return [...freq.entries()]
      .sort((a,b)=>b[1]-a[1])
      .slice(0,n)
      .map(([k])=>k);
  }
  function chip(label, on){
    return `<button data-tag="${esc(label)}" class="chip" style="
      display:inline-block;border:1px solid #ddd;border-radius:16px;padding:4px 10px;margin:3px;
      background:${on?'#eee':'#fff'}">${esc(label)}</button>`;
  }
  function renderQuick(){
    const tags = topNTags(20);
    quick.innerHTML = '<div style="margin-bottom:4px;opacity:.8;font-size:.9em;">よく使われるタグ</div>' +
      tags.map(t => chip(t, activeTags.has(t))).join('');
  }
  function scoreOf(it){
    const s = Number(it['stars/downloads']||0);
    const star_part = Math.log10(Math.max(1, s));
    let recency = 0.0;
    try{
      const ok = it.updated_at && it.updated_at.slice(0,10) >= (new Date(Date.now()-30*86400*1000)).toISOString().slice(0,10);
      recency = ok ? 0.6 : 0.0;
    }catch(e){ recency = 0.0; }
    return Math.round((star_part + recency)*1000)/1000;
  }
  function card(x){
    const tagHtml = (x.tags||[]).map(esc).join(', ');
    const lic = (x.tags||[]).find(t=>/^license:/.test(t));
    const licStr = lic ? lic.replace(/^license:/,'') : '';
    const badge = x.source_type ? esc(x.source_type) : '';
    const title = esc(x.title||'');
    const desc = esc(x.short_desc||'');
    const score = typeof x.score === 'number' ? x.score : scoreOf(x);
    const u = x.url || '#';
    return `
      <div class="card" style="margin:12px 0;padding:12px;border:1px solid #e5e5e5;border-radius:8px;">
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
          <b style="font-size:1.05em;">${title}</b>
          ${badge?`<span style="border:1px solid #ddd;border-radius:12px;padding:2px 8px;font-size:.85em;opacity:.8;">${badge}</span>`:''}
          ${licStr?`<span style="border:1px solid #ddd;border-radius:12px;padding:2px 8px;font-size:.85em;opacity:.8;">license:${esc(licStr)}</span>`:''}
          <span style="opacity:.8;font-size:.9em;">score: ${score}</span>
          <span style="opacity:.8;font-size:.9em;">更新: ${esc(toDate(x.updated_at))}</span>
          <a href="${esc(u)}" target="_blank" rel="noopener" data-outbound="1" style="margin-left:auto;">Open</a>
        </div>
        <div style="margin-top:6px;">${desc}</div>
        ${tagHtml?`<div style="margin-top:6px;opacity:.9;"><small>tags: ${tagHtml}</small></div>`:''}
      </div>`;
  }
  function applyFilters(){
    const qval = (q.value||'').toLowerCase().trim();
    const typ = (typeSel.value||'').trim();
    const lic = (licenseSel.value||'').trim();

    let arr = data.filter(x=>{
      if(typ && x.source_type!==typ) return false;
      if(lic){
        const hasLic = (x.tags||[]).some(t=>t.toLowerCase()===('license:'+lic).toLowerCase());
        if(!hasLic) return false;
      }
      if(activeTags.size>0){
        const tags = new Set((x.tags||[]));
        for(const t of activeTags){ if(!tags.has(t)) return false; }
      }
      if(qval){
        const hay = [
          (x.title||''), (x.short_desc||''), (x.source_type||''), ...(x.tags||[])
        ].join(' ').toLowerCase();
        if(!hay.includes(qval)) return false;
      }
      return true;
    });

    const how = sortSel.value;
    if(how==='latest'){
      arr.sort((a,b)=>String(b.updated_at).localeCompare(String(a.updated_at)));
    }else if(how==='score'){
      arr.sort((a,b)=>(b.score ?? scoreOf(b)) - (a.score ?? scoreOf(a)));
    }else if(how==='title'){
      arr.sort((a,b)=>String(a.title).localeCompare(String(b.title)));
    }
    count.textContent = arr.length;

    const pageMax = Math.max(1, Math.ceil(arr.length / PAGE));
    if(page > pageMax) page = pageMax;
    const start = (page-1)*PAGE;
    const pageArr = arr.slice(start, start+PAGE);
    pageInfo.textContent = `${page}/${pageMax}`;

    list.innerHTML = pageArr.map(card).join('');
    list.querySelectorAll('a[data-outbound="1"]').forEach(a=>{
      a.addEventListener('click', ()=>{
        if(window.plausible){
          window.plausible('Open', { props: { source_type: a.closest('.card')?.querySelector('span')?.textContent || '', title: a.closest('.card')?.querySelector('b')?.textContent || '' } });
        }
      });
    });
  }

  renderQuick();
  applyFilters();

  quick.addEventListener('click', (e)=>{
    const btn = e.target.closest('button[data-tag]');
    if(!btn) return;
    const tag = btn.getAttribute('data-tag');
    if(activeTags.has(tag)) activeTags.delete(tag); else activeTags.add(tag);
    renderQuick();
    applyFilters();
    if(window.plausible){ window.plausible('TagFilter', {props:{ tag }}); }
  });

  let tId=null;
  q.addEventListener('input', ()=>{
    clearTimeout(tId);
    tId=setTimeout(()=>{
      page=1;
      applyFilters();
      if(window.plausible){ window.plausible('Search', {props:{ q: q.value }}); }
    }, 400);
  });

  [sortSel, typeSel, licenseSel].forEach(sel=>{
    sel.addEventListener('change', ()=>{
      page=1; applyFilters();
      if(window.plausible){ window.plausible('Select', {props:{ id: sel.id, value: sel.value }}); }
    });
  });

  prev.addEventListener('click', ()=>{ if(page>1){ page--; applyFilters(); }});
  next.addEventListener('click', ()=>{ page++; applyFilters(); });
})();
</script>